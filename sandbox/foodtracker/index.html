<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, shrink-to-fit=no">
    <meta name="theme-color" content="e8e4e0">
    <title>Food Tracker</title>
    <style>
      * { 
        position: relative;
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      :root {
        --header-height: 60px;
        --background-primary: #f4f2f0;
        --background-secondary: #e8e4e0;
        --color-primary: #18181f;
        --color-secondary: #28282f;
        --gutter: 16px;
      }

      @media (prefers-color-scheme: dark) {
        :root {
          --background-primary: #141210;
          --background-secondary: #282420;
          --color-primary: #d8d8df;
          --color-secondary: #e8e8ef;
        }
      }

      body {
        background: var(--background-primary);
        color: var(--color-primary);
        font-family: sans-serif;
      }

      h1,
      h2 {
        font-weight: 300;
      }

      header {
        display: flex;
        align-items: center;
        justify-content: center;
        position: sticky;
        top: 0;
        left: 0;
        width: 100%;
        height: var(--header-height);
        background: var(--background-secondary);
      }

      main {
        padding: 16px;
        width: 100%;
      }

      .row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--gutter) 0;
        border-bottom: 1px solid var(--color-secondary);
      }

      .row__name {
        text-transform: capitalize;
        flex-grow: 1;
      }

      .row__value {
        display: flex;
        margin-right: calc(var(--gutter) * 2);
      }

      .row__value:last-of-type {
        margin-right: 0;
      }

      .row__output {
        margin-right: calc(var(--gutter) / 2);
        font-size: 1.17em;
        font-weight: 300;
      }

      .row__value--current .output__value {
        min-width: 300%;
        background-image: linear-gradient(to right, #f06, #aa0, #0b9);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        transition: background-position 0.3s;
      }

      .row__button {
        width: 2em;
        height: 2em;
        background: transparent;
        border: none;
        border-radius: 0;
        box-shadow: 0px 0px 2px rgba(128, 128, 128, 0.5);
        color: inherit;
      }

      aside {
        position: fixed;
        top: 0;
        right: 0;
        height: 100%;
        background-color: var(--background-secondary);
        transform: translateX(100%);
        transition: transform 0.3s;
      }

      #toggleMenu:checked ~ aside {
        transform: translateX(0);
      }

      label[for="toggleMenu"] {
        position: absolute;
        display: flex;
        align-items: center;
        justify-content: space-around;
        width: var(--header-height);
        height: var(--header-height);
        padding: var(--gutter);
        background-color: var(--background-secondary);
        transform: translateX(-100%);
      }

      label[for="toggleMenu"] span {
        width: 100%;
        height: 1px;
        background-color: var(--color-primary);
        transition: transform 0.3s;
      }

      label[for="toggleMenu"] span::before,
      label[for="toggleMenu"] span::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: inherit;
        transition: inherit;
      }

      label[for="toggleMenu"] span::before {
        transform: translateY(calc(var(--gutter) / 2));
      }

      label[for="toggleMenu"] span::after {
        transform: translateY(calc(var(--gutter) / -2));
      }

      #toggleMenu:checked ~ aside label[for="toggleMenu"] span {
        transform: rotate(-45deg);
      }

      #toggleMenu:checked ~ aside label[for="toggleMenu"] span::before,
      #toggleMenu:checked ~ aside label[for="toggleMenu"] span::after {
        transform: rotate(90deg);
      }

      aside ul {
        list-style: none;
      }

      .menu__item {
        padding: var(--gutter) calc(var(--gutter) * 2);
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <input id="toggleMenu" type="checkbox" hidden>

    <header>
      <h1>Food Tracker</h1>
    </header>

    <main>
      
    </main>

    <aside>
      <label for="toggleMenu"><span></span></label>
      <ul>
        <li class="menu__item" data-action="current">Clear Today</li>
        <li class="menu__item" data-action="total">Clear Goals</li>
        <li class="menu__item" data-action="*">Clear All</li>
        <!-- <li>
          Color Scheme:
          <span><span></span></span>
        </li> -->
      </ul>
    </aside>

    <script>
      const types= [
        'grains',
        'fruitables',
        'dairy',
        'protein',
        'fats',
        'sweets'
      ];

      const data = {};

      const $ = x => document.querySelector(x);
      const $$ = x => [...document.querySelectorAll(x)];

      const template = data => `
        <div class="row" data-type="${data.name}">
          <div class="row__name"><h2>${data.name}</h2></div>
          <div class="row__value row__value--current">
            <div class="row__output">
              <div class="output__value output__value">${data.current}</div>
            </div>
            <div class="row__adjust row__adjust">
              <button class="row__button row__button--decrease">-</button>
              <button class="row__button row__button--increase">+</button>
            </div>
          </div>
          <div class="row__value row__value--total">
            <div class="row__output">
              <div class="output__value">${data.total}</div>
            </div>
            <div class="row__adjust row__adjust">
              <button class="row__button row__button--decrease">-</button>
              <button class="row__button row__button--increase">+</button>
            </div>
          </div>
        </div>
      `;

      const ls = (action, key, value) => {
        if ('localStorage' in window) {
          switch (action) {
            case 'get':
              let result = localStorage.getItem(key);
              try {
                result = JSON.parse(result);
              } catch (err) {}
              return result;

            case 'set':
              localStorage.setItem(key, JSON.stringify(value));
              return true;

            case 'clear':
              localStorage.clear();
              break;
          }
        } else {
          return false;
        }
      };

      const onMenuItemClick = evt => {
        const { target } = evt;
        const { action } = target.dataset;
        const isResetAll = action === '*';

        Object.keys(data).forEach(type => {
          if (isResetAll) {
            data[type].current = 0;
            data[type].active = 0;
          } else {
            data[type][action] = 0;
          }
        });

        ls('set', 'foodtracker', data);
        populateDOM();
        stylize();
        attachListeners();

        $('#toggleMenu').checked = null;
      }

      const onBtnClick = (evt) => {
        const { currentTarget: btn } = evt;
        const direction = btn.className.includes('increase') ? 1 : -1;
        const isCurrent = !!btn.closest('.row__value--current');
        const type = btn.closest('.row').dataset.type;

        data[type][isCurrent ? 'current' : 'total'] += 1 * direction;

        ls('set', 'foodtracker', data);
        populateDOM();
        stylize();
        attachListeners();
      };

      const attachListeners = () => {
        $$('button').forEach(btn => {
          btn.addEventListener('click', onBtnClick);
        });

        $$('.menu__item').forEach(menuItem => {
          menuItem.addEventListener('click', onMenuItemClick);
        })
      };

      const stylize = () => {
        $$('.row').forEach(row => {
          const { type } = row.dataset;
          const outputValueCurrent = row.querySelector('.row__value--current .output__value');

          Object.assign(outputValueCurrent.style, {
            backgroundSize: `${(data[type].total + 1) * 100}% 100%`,
            backgroundPosition: `${(data[type].current) * -100}% 0%`
          });
        })
      };

      const populateDOM = () => {
        $('main').innerHTML = '';
        for (const type in data) {
          $('main').innerHTML += template(data[type]);
        }
      };

      const getData = () => {
        const lsData = ls('get', 'foodtracker');
        if (lsData && typeof lsData === 'object') {
          for (const type of types) {
            data[type] = {
              name: type,
              current: lsData[type].current || 0,
              total: lsData[type].total || 0
            };
          }
          return lsData;
        } else {
          for (const type of types) {
            data[type] = {
              name: type,
              current: 0,
              total: 0
            };
          }
        }
        return data;
      };

      const initFns = () => {
        getData();
        populateDOM();
        stylize();
        attachListeners();
      };

      initFns();
    </script>
  </body>
</html>